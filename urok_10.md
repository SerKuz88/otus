# otus
1. Настройте выполнение контрольной точки раз в 30 секунд.  
![image](https://user-images.githubusercontent.com/108919955/184525084-35013ee7-d60c-406b-9b8c-20404d8509f7.png)
   
3. 10 минут c помощью утилиты pgbench подавайте нагрузку.  
![image](https://user-images.githubusercontent.com/108919955/184526422-c293c5e3-5e2f-4758-91f3-a9ce1cd0743a.png)
  
5. Измерьте, какой объем журнальных файлов был сгенерирован за это время. Оцените, какой   
объем приходится в среднем на одну контрольную точку.  
![image](https://user-images.githubusercontent.com/108919955/184526454-e60e16d0-dd39-4d41-8516-a3995b46cc19.png)  
  
было сгененрировано 4 файла по 16 мб каждый, в среднем получается на одну контрольную точку приходится 16мб.  
  
4. Проверьте данные статистики: все ли контрольные точки выполнялись точно по расписанию. 
Почему так произошло?  

оказывается wal файлы перезаписывались по кругу (всего 4 файла)
статистика показывает только 4 wal файла.  
по этому сделал следующее:  
создал директорию "wal_files" и настроил параметры для копирования туда wal файлов:  
wal_level =replica  
archive_mode = on   
archive_command = 'test ! -f /var/lib/postgresql/wal_files/%f && cp %p /var/lib/postgresql/wal_files/%f'  
  
в результате в новой директории получил 25 файлов за 10 минут нагрузки, в среднем получается 24 секунды, это говорит что контрольна точка выполнялась раньше, т.к. 16 мб файл заполнялся раньше чем за 30 сек.   
(только не понятно почему файлы по 16 мб? ведь параметры в базе следующие: max_wal_size=1гб а min_wal_size=80мб)  
![image](https://user-images.githubusercontent.com/108919955/184529235-828236b3-2763-45ea-b3b6-c948922c53cc.png)
  
5. Сравните tps в синхронном/асинхронном режиме утилитой pgbench. Объясните полученный 
результат.  
   
в асинхронном режиме tps увеличился в 4.5 раза   
![image](https://user-images.githubusercontent.com/108919955/184529681-966bc7fc-5cfd-4020-97b4-15b06b9e63ca.png)  
это говорит о том, что транзакция завершается немедленно и не ждет пока все журнальные записи об этой транзакции окажутся на диске. Журнал записывается в фоновом режиме. Поэтому и увеличивается скорость. но тогда рискуем во время сбоя потерять данные.  

6. Создайте новый кластер с включенной контрольной суммой страниц. Создайте таблицу.
Вставьте несколько значений. Выключите кластер. Измените пару байт в таблице. Включите 
кластер и сделайте выборку из таблицы. Что и почему произошло? как проигнорировать ошибку и 
продолжить работу?  
